<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feel - è®©ç®—æ³•è¯»æ‡‚ä½ çš„çµé­‚</title>
  <!-- Lenis CSS å·²ç§»é™¤ï¼Œå› ä¸ºCDNé“¾æ¥ä¸å¯ç”¨ -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="navbar.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <!-- Lenis JavaScript å·²ç§»é™¤ï¼Œå› ä¸ºCDNé“¾æ¥å¯èƒ½ä¸å¯ç”¨ -->
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: #333;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* ç²’å­èƒŒæ™¯ */
    .particles-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 50%;
      animation: float 20s linear infinite;
    }

    @keyframes float {
      0% {
        transform: translateY(100vh) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) translateX(100px);
        opacity: 0;
      }
    }


    /* ä¸»å®¹å™¨ */
    .main-container {
      padding-top: 100px;
      min-height: 100vh;
      position: relative;
      z-index: 2;
    }

    /* æ•°æ®å¡«å†™åŒºåŸŸ */
    .data-input-section {
      padding: 80px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .section-title {
      text-align: center;
      font-size: 3rem;
      font-weight: 700;
      color: white;
      margin-bottom: 20px;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .section-subtitle {
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      font-size: 1.2rem;
      margin-bottom: 60px;
      font-weight: 300;
    }

    .steps-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 40px;
      margin-bottom: 80px;
    }

    .step-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      padding: 40px 30px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .step-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }

    .step-card:hover::before {
      left: 100%;
    }

    .step-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    }

    .step-icon {
      font-size: 3rem;
      margin-bottom: 20px;
      display: block;
    }

    .step-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: white;
      margin-bottom: 15px;
    }

    .step-description {
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 30px;
      line-height: 1.6;
    }

    /* å…´è¶£æ ‡ç­¾ */
    .interest-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .tag {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .tag:hover, .tag.selected {
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(110, 139, 255, 0.3);
    }

    /* æ€§æ ¼æµ‹è¯„ */
    .personality-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .personality-option {
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }

    .personality-option:hover, .personality-option.selected {
      background: rgba(110, 139, 255, 0.3);
      border-color: #6E8BFF;
      transform: translateX(10px);
    }

    /* æ˜Ÿåº§é€‰æ‹© */
    .constellation-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .constellation-option {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-size: 0.9rem;
    }

    .constellation-option:hover, .constellation-option.selected {
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(110, 139, 255, 0.3);
    }

    .constellation-option.other-option {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .constellation-option.other-option.selected {
      flex-direction: column;
      align-items: stretch;
    }

    .constellation-option.other-option .other-input {
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      margin-top: 10px;
    }

    .constellation-option.other-option .other-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    /* ç”Ÿæ´»ç†å¿µ */
    .lifestyle-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .lifestyle-option {
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }

    .lifestyle-option:hover, .lifestyle-option.selected {
      background: rgba(110, 139, 255, 0.3);
      border-color: #6E8BFF;
      transform: translateY(-5px);
    }

    .lifestyle-option.other-option {
      grid-column: 1 / -1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .lifestyle-option.other-option.selected {
      flex-direction: column;
    }

    .lifestyle-option.other-option .other-input {
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      margin-top: 10px;
    }

    .lifestyle-option.other-option .other-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    /* ç¤¾äº¤åå¥½ */
    .social-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .social-option {
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
    }

    .social-option:hover, .social-option.selected {
      background: rgba(110, 139, 255, 0.3);
      border-color: #6E8BFF;
      transform: translateY(-5px);
    }

    .social-option.other-option {
      grid-column: 1 / -1;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    .social-option.other-option.selected {
      flex-direction: column;
    }

    .social-option.other-option .other-input {
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      color: white;
      margin-top: 10px;
    }

    .social-option.other-option .other-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    /* è¯­éŸ³ä¸Šä¼ åŒºåŸŸ */
    .voice-upload {
      border: 2px dashed rgba(255, 255, 255, 0.3);
      border-radius: 15px;
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .voice-upload:hover {
      border-color: #6E8BFF;
      background: rgba(110, 139, 255, 0.1);
    }

    .voice-wave {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 3px;
      margin: 20px 0;
    }

    .wave-bar {
      width: 4px;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      border-radius: 2px;
      animation: wave-animation 1.5s ease-in-out infinite;
    }

    .wave-bar:nth-child(1) { height: 20px; animation-delay: 0s; }
    .wave-bar:nth-child(2) { height: 35px; animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { height: 25px; animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { height: 40px; animation-delay: 0.3s; }
    .wave-bar:nth-child(5) { height: 30px; animation-delay: 0.4s; }
    .wave-bar:nth-child(6) { height: 35px; animation-delay: 0.5s; }
    .wave-bar:nth-child(7) { height: 20px; animation-delay: 0.6s; }

    @keyframes wave-animation {
      0%, 100% { transform: scaleY(0.5); }
      50% { transform: scaleY(1); }
    }

    /* åŒ¹é…ç»“æœåŒºåŸŸ */
    .match-result-section {
      padding: 80px 40px;
      text-align: center;
      position: relative;
    }

    .match-container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    .soul-sphere {
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      margin: 0 auto 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      font-weight: 700;
      position: relative;
      box-shadow: 0 20px 40px rgba(110, 139, 255, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    .soul-sphere::before {
      content: '';
      position: absolute;
      top: -10px;
      left: -10px;
      right: -10px;
      bottom: -10px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      opacity: 0.3;
      animation: ripple 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes ripple {
      0% { transform: scale(0.8); opacity: 0.8; }
      100% { transform: scale(1.2); opacity: 0; }
    }

    .match-percentage {
      font-size: 4rem;
      font-weight: 700;
      color: white;
      margin-bottom: 20px;
      text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .match-description {
      color: rgba(255, 255, 255, 0.9);
      font-size: 1.2rem;
      margin-bottom: 40px;
      line-height: 1.6;
    }

    /* æ¨èé¢æ¿ */
    .recommendation-panel {
      position: fixed;
      right: 40px;
      top: 50%;
      transform: translateY(-50%);
      width: 300px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 100;
    }

    .panel-title {
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 20px;
    }

    .recommendation-item {
  display: flex;
  align-items: flex-start; /* é¡¶éƒ¨å¯¹é½ï¼Œé€‚é…é«˜é«˜åº¦ */
  gap: 15px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  margin-bottom: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 200px; /* æœ€å°é«˜åº¦200pxï¼Œå¯æŒ‰éœ€è°ƒå¤§ï¼ˆå¦‚300pxï¼‰ */
}

.recommendation-item:hover {
  background: rgba(110, 139, 255, 0.2);
  transform: translateX(5px);
}

    .rec-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #FF9A9E, #FAD0C4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .rec-info {
      flex: 1;
    }

    .rec-name {
      color: white;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .rec-percentage {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.9rem;
    }

    .topics-cloud {
      margin-top: 20px;
    }

    .topic-tag {
      display: inline-block;
      padding: 5px 12px;
      background: rgba(110, 139, 255, 0.3);
      border-radius: 15px;
      color: white;
      font-size: 0.8rem;
      margin: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .topic-tag:hover {
      background: rgba(110, 139, 255, 0.5);
      transform: scale(1.05);
    }

    /* åº•éƒ¨CTA */
    .cta-section {
      padding: 80px 40px;
      text-align: center;
    }

    .cta-button {
      display: inline-block;
      padding: 20px 40px;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      color: white;
      text-decoration: none;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1.2rem;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(110, 139, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .cta-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .cta-button:hover::before {
      left: 100%;
    }

    .cta-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(110, 139, 255, 0.4);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .navbar {
        padding: 15px 20px;
      }

      .nav-center {
        display: none;
      }

      .steps-container {
        grid-template-columns: 1fr;
        gap: 30px;
      }

      .recommendation-panel {
        position: static;
        transform: none;
        width: 100%;
        margin-top: 40px;
      }

      .section-title {
        font-size: 2rem;
      }

      .match-percentage {
        font-size: 3rem;
      }
    }

    /* åŠ è½½åŠ¨ç”» */
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    .loading.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* ç”¨æˆ·ä¿¡æ¯å¼¹çª—æ ·å¼ */
    .user-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .user-modal.show {
      display: flex;
    }

    .user-modal-content {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    /* èŠå¤©ç•Œé¢æ ·å¼ */
    .chat-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .chat-modal.show {
      display: flex;
    }

    .chat-modal-content {
      background: white;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      height: 80vh;
      max-height: 800px;
      display: flex;
      flex-direction: column;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
      overflow: hidden;
    }

    .chat-header {
      background: #4285F4;
      color: white;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .chat-header-title {
      font-size: 1.2rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chat-header-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .chat-header-menu {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.2rem;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      animation: messageSlideIn 0.3s ease-out;
    }

    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.own {
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      border: 2px solid rgba(0, 0, 0, 0.1);
    }

    .message-bubble {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 18px;
      word-wrap: break-word;
      line-height: 1.4;
    }

    .message:not(.own) .message-bubble {
      background: white;
      border-bottom-left-radius: 4px;
      color: #333;
    }

    .message.own .message-bubble {
      background: #4285F4;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .chat-input-area {
      padding: 15px;
      background: white;
      border-top: 1px solid #e0e0e0;
      flex-shrink: 0;
    }

    .ai-greeting-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .ai-greeting-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(110, 139, 255, 0.3);
    }

    .ai-greeting-btn:active {
      transform: translateY(0);
    }

    .chat-input-container {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #f5f5f5;
      border-radius: 25px;
      padding: 8px 15px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .chat-input-microphone {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #666;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .chat-input-field {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 1rem;
      padding: 8px 0;
      color: #333;
    }

    .chat-input-field::placeholder {
      color: #999;
    }

    .chat-send-btn {
      padding: 8px 20px;
      background: #4285F4;
      color: white;
      border: none;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .chat-send-btn:hover {
      background: #357AE8;
      transform: scale(1.05);
    }

    .chat-send-btn:active {
      transform: scale(0.95);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    .modal-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      margin: 0;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f5f5f5;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: #e0e0e0;
      transform: rotate(90deg);
    }

    .user-info-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    .user-info-table td {
      padding: 15px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 1rem;
    }

    .user-info-table td:first-child {
      font-weight: 600;
      color: #666;
      width: 30%;
    }

    .user-info-table td:last-child {
      color: #333;
    }

    .user-avatar-large {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 20px;
      display: block;
      border: 4px solid #6E8BFF;
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #6E8BFF;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .error-message {
      color: #ff4757;
      text-align: center;
      padding: 20px;
      background: #ffe6e6;
      border-radius: 10px;
      margin: 20px 0;
    }

    /* è¡¨å•æ ·å¼ */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: #fafbfc;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: #6E8BFF;
      background: white;
      box-shadow: 0 0 0 3px rgba(110, 139, 255, 0.1);
    }

    .form-input.error {
      border-color: #ff4757;
      background: #ffe6e6;
    }

    textarea.form-input {
      resize: vertical;
      min-height: 80px;
    }

    select.form-input {
      cursor: pointer;
    }

    /* é—®å·æŒ‰é’®æ ·å¼ */
    .questionnaire-btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 16px 32px;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      color: white;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(110, 139, 255, 0.3);
      position: relative;
      overflow: hidden;
    }

    .questionnaire-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .questionnaire-btn:hover::before {
      left: 100%;
    }

    .questionnaire-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(110, 139, 255, 0.4);
    }

    .questionnaire-btn:active {
      transform: translateY(-1px);
    }

    .btn-icon {
      font-size: 1.3rem;
    }

    .btn-text {
      font-weight: 600;
    }

    .btn-arrow {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .questionnaire-btn:hover .btn-arrow {
      transform: translateX(5px);
    }

    /* é—®å·å¼¹çª—æ ·å¼ */
    .questionnaire-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .questionnaire-modal.show {
      display: flex;
    }

    .questionnaire-modal-content {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease-out;
    }

    .questionnaire-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
    }

    .questionnaire-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #333;
      margin: 0;
    }

    .questionnaire-close {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f5f5f5;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .questionnaire-close:hover {
      background: #e0e0e0;
      transform: rotate(90deg);
    }

    .questionnaire-form {
      display: grid;
      gap: 20px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-row.single {
      grid-template-columns: 1fr;
    }

    .questionnaire-btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      justify-content: center;
    }

    .questionnaire-btn-group button {
      flex: 1;
      max-width: 200px;
    }

    /* ç”¨æˆ·å¡ç‰‡åˆ—è¡¨æ ·å¼ */
    .user-cards-container {
      width: 100%;
      padding: 40px 20px;
    }

    .user-cards-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
      margin-bottom: 40px;
      align-items: start;
    }

    .user-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 380px;
      max-height: 420px;
    }

    .user-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transition: left 0.5s;
    }

    .user-card:hover::before {
      left: 100%;
    }

    .user-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border-color: rgba(110, 139, 255, 0.5);
    }

    .user-card-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      flex-shrink: 0;
    }

    .user-card-avatar {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }

    .user-card-avatar-placeholder {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.8rem;
      font-weight: 700;
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      flex-shrink: 0;
    }

    .user-card-info {
      flex: 1;
    }

    .user-card-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      margin-bottom: 4px;
      line-height: 1.4;
    }

    .user-card-age {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 8px;
    }

    .user-card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .user-card-tag {
      padding: 4px 10px;
      background: rgba(110, 139, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 0.75rem;
      white-space: nowrap;
    }

    .user-card-introduce {
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.5;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
      flex: 1;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      text-overflow: ellipsis;
    }

    .user-card-hobbies {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .user-card-hobbies-title {
      color: rgba(255, 255, 255, 0.7);
      font-size: 0.85rem;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .cards-loading {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
    }

    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty-state {
      text-align: center;
      padding: 60px 40px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      margin: 40px auto;
      max-width: 500px;
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.8;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    .empty-title {
      color: white;
      font-size: 1.8rem;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .empty-description {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 0;
    }

    /* ç¿»é¡µæŒ‰é’®æ ·å¼ */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 40px;
    }

    .pagination-btn {
      padding: 12px 30px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      color: white;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .pagination-btn:hover:not(:disabled) {
      background: linear-gradient(45deg, #6E8BFF, #A06BFF);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(110, 139, 255, 0.3);
    }

    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      color: white;
      font-size: 1.1rem;
      font-weight: 500;
      padding: 0 20px;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1024px) {
      .user-cards-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .user-cards-grid {
        grid-template-columns: 1fr;
      }

      .pagination-container {
        flex-direction: column;
        gap: 15px;
      }

      .pagination-btn {
        width: 100%;
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- åŠ è½½åŠ¨ç”» -->
  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
  </div>

  <!-- ç²’å­èƒŒæ™¯ -->
  <div class="particles-bg" id="particlesBg"></div>

  <!-- å¯¼èˆªæ é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
  <div id="navbar-container"></div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="main-container">
    <!-- æ•°æ®å¡«å†™åŒºåŸŸ -->
    <section class="data-input-section">
      <h1 class="section-title">å‘ç°ä½ çš„çµé­‚é¢‘ç‡</h1>
      <p class="section-subtitle">é€‰æ‹©ä½ çš„å…´è¶£ï¼Œè®©AIæ‰¾åˆ°å¿—åŒé“åˆçš„äºº</p>
      
      
      

      <div class="steps-container">
        <!-- å…´è¶£æ ‡ç­¾æ¨¡å— -->
        <!-- ç”¨æˆ·å¡ç‰‡åˆ—è¡¨ -->
        <div class="user-cards-container">
          <h3 class="step-title" style="text-align: center; margin-bottom: 40px; color: white; font-size: 2rem;">å‘ç°ç›¸ä¼¼çµé­‚</h3>
          
          <!-- ç”¨æˆ·å¡ç‰‡åˆ—è¡¨ -->
          <div class="user-cards-grid" id="userCardsGrid">
            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="cards-loading" id="cardsLoading">
              <div class="loading-spinner"></div>
              <p style="color: white; margin-top: 20px;">æ­£åœ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯...</p>
            </div>
          </div>
          
          <!-- ç¿»é¡µæŒ‰é’® -->
          <div class="pagination-container" id="paginationContainer" style="display: none;">
            <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)">
              <span>â†</span> ä¸Šä¸€é¡µ
            </button>
            <span class="page-info" id="pageInfo">ç¬¬ 1 é¡µ</span>
            <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)">
              ä¸‹ä¸€é¡µ <span>â†’</span>
            </button>
          </div>
        </div>
      </div>
      <!-- é—®å·æŒ‰é’®
      <div style="text-align: center; margin-top: 30px;">
        <button class="questionnaire-btn" onclick="showQuestionnaireModal()">
          <span class="btn-icon">ğŸ“‹</span>
          <span class="btn-text">å®Œå–„ä¸ªäººä¿¡æ¯</span>
          <span class="btn-arrow">â†’</span>
        </button>
      </div> -->
      <!-- æ¨èé¢æ¿ -->
      <div id="recommendationContent">
        <div class="empty-state">
          <div class="empty-icon">ğŸ”</div>
          <h3 class="empty-title">å‘ç°ç›¸ä¼¼çµé­‚</h3>
          <p class="empty-description">å®Œå–„ä¸ªäººä¿¡æ¯åï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æ¨èå¿—åŒé“åˆçš„æœ‹å‹</p>
          <button class="questionnaire-btn" onclick="showQuestionnaireModal()" style="margin-top: 24px;">
            <span class="btn-icon">ğŸ“‹</span>
            <span class="btn-text">å¼€å§‹åŒ¹é…</span>
            <span class="btn-arrow">â†’</span>
          </button>
        </div>
      </div>
    </section>

<!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
<section class="match-result-section">
  <div class="match-container">
    <div class="soul-sphere" id="soulSphere">ğŸ“</div>
    <h2 class="section-title" style="font-size: 2.5rem; margin-bottom: 20px;">ä¸Šä¼ ä½ çš„æ€§æ ¼æŠ¥å‘Š</h2>
    <p class="match-description" style="margin-bottom: 30px;">
      ä¸Šä¼ ä½ çš„æ€§æ ¼æµ‹è¯•æŠ¥å‘ŠPDFæ–‡ä»¶ï¼Œè®©æˆ‘ä»¬æ›´ç²¾å‡†åœ°åˆ†æä½ çš„æ€§æ ¼ç‰¹å¾
    </p>
    <button class="cta-button" id="uploadVoiceBtn">
      <span class="btn-icon">ğŸ“„</span>
      <span class="btn-text">ä¸Šä¼ æ€§æ ¼æŠ¥å‘Š</span>
      <span class="btn-arrow">â†’</span>
    </button>
    
    <!-- AIåˆ†æç»“æœå±•ç¤ºåŒºåŸŸ -->
    <div id="aiAnalysisResult" style="margin-top: 30px; display: none;">
      <div style="background: rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
        <h3 style="color: white; margin-top: 0; margin-bottom: 15px; font-size: 1.5rem; font-weight: 600;">AIåˆ†æç»“æœ</h3>
        <div id="analysisContent" style="color: rgba(255, 255, 255, 0.9); line-height: 1.6; font-size: 1rem;">
          <!-- åˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        <div id="analysisLoading" style="display: none; text-align: center; padding: 20px;">
          <div class="loading-spinner"></div>
          <p style="color: white; margin-top: 15px;">AIæ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
<div class="user-modal" id="fileUploadModal">
  <div class="user-modal-content" style="max-width: 500px;">
    <div class="modal-header">
      <h3 class="modal-title">ä¸Šä¼ æ€§æ ¼æŠ¥å‘Š</h3>
      <button class="modal-close" id="closeFileUploadModal">Ã—</button>
    </div>
    <div id="fileUploadContent" style="padding: 20px 0;">
      <form id="voiceUploadForm" enctype="multipart/form-data">
        <div class="form-group">
          <label class="form-label">é€‰æ‹©PDFæ–‡ä»¶</label>
          <input type="file" id="voiceFile" class="form-input" accept=".pdf,application/pdf" required>
          <p style="color: #666; font-size: 0.9rem; margin-top: 8px;">
            ä»…æ”¯æŒ PDF æ ¼å¼ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MB
          </p>
        </div>
        
        <div class="form-group">
          <label class="form-label">æŠ¥å‘Šæè¿°ï¼ˆå¯é€‰ï¼‰</label>
          <input type="text" id="fileDescription" class="form-input" placeholder="ä¾‹å¦‚ï¼šMBTIæµ‹è¯•æŠ¥å‘Šã€ä¹å‹äººæ ¼æµ‹è¯•ç­‰">
        </div>
        
        <div style="display: flex; gap: 15px; margin-top: 30px;">
          <button type="button" id="submitVoiceFile" class="questionnaire-btn" style="flex: 1; margin: 0;">
            <span class="btn-icon">ğŸ“¤</span>
            <span class="btn-text">ä¸Šä¼ æ–‡ä»¶</span>
            <span class="btn-arrow">â†’</span>
          </button>
          <button type="button" id="cancelFileUpload" class="questionnaire-btn" style="flex: 1; margin: 0; background: #ccc;">
            <span class="btn-text">å–æ¶ˆ</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- åº•éƒ¨CTA -->
    <section class="cta-section">
      <h2 style="color: white; font-size: 2.5rem; margin-bottom: 20px;">è®©ç®—æ³•å¸¦ä½ æ‰¾åˆ°æ‡‚ä½ çš„äºº</h2>
      <p style="color: rgba(255, 255, 255, 0.8); font-size: 1.2rem; margin-bottom: 40px;">
        åŸºäºæ·±åº¦å­¦ä¹ çš„çµé­‚åŒ¹é…ç®—æ³•ï¼Œä¸ºä½ æ‰¾åˆ°æœ€å¥‘åˆçš„å¿ƒçµä¼´ä¾£
      </p>
      <a href="#" class="cta-button">å¼€å§‹çµé­‚åŒ¹é…ä¹‹æ—…</a>
    </section>
  </div>

  <!-- æ¨èé¢æ¿
  <div class="recommendation-panel" id="recommendationPanel">
    <h3 class="panel-title">ç›¸ä¼¼çµé­‚</h3>
    
    <div id="recommendationContent">
      <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.7);">
        <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ”</div>
        <p>å®Œå–„ä¸ªäººä¿¡æ¯åï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æ¨èå¿—åŒé“åˆçš„æœ‹å‹</p>
        <button class="questionnaire-btn" onclick="showQuestionnaireModal()" style="margin-top: 20px;">
          <span class="btn-icon">ğŸ“‹</span>
          <span class="btn-text">å¼€å§‹åŒ¹é…</span>
          <span class="btn-arrow">â†’</span>
        </button>
      </div>
    </div>
  </div> -->

  <!-- ç”¨æˆ·ä¿¡æ¯å¼¹çª— -->
  <div class="user-modal" id="userModal">
    <div class="user-modal-content">
      <div class="modal-header">
        <h3 class="modal-title">ä¸ªäººä¿¡æ¯</h3>
        <button class="modal-close" id="closeModal">Ã—</button>
      </div>
      <div id="userInfoContent">
        <!-- ç”¨æˆ·ä¿¡æ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
      </div>
    </div>
  </div>

  <!-- èŠå¤©å¼¹çª— -->
  <div class="chat-modal" id="chatModal">
    <div class="chat-modal-content">
      <div class="chat-header">
        <div class="chat-header-title">
          <img id="chatHeaderAvatar" class="chat-header-avatar" src="" alt="å¤´åƒ" onerror="this.style.display='none';">
          <span id="chatHeaderName">Chatterbot</span>
        </div>
        <button class="chat-header-menu" id="closeChatModal" style="background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">Ã—</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <!-- æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
      </div>
      <div class="chat-input-area">
        <button class="ai-greeting-btn" id="aiGreetingBtn">AIé—®å€™</button>
        <div class="chat-input-container">
          <div class="chat-input-microphone">ğŸ¤</div>
          <input type="text" class="chat-input-field" id="chatInput" placeholder="è¾“å…¥æ¶ˆæ¯..." />
          <button class="chat-send-btn" id="chatSendBtn">å‘é€</button>
        </div>
      </div>
    </div>
  </div>

  <!-- é—®å·å¼¹çª— -->
  <div class="questionnaire-modal" id="questionnaireModal">
    <div class="questionnaire-modal-content">
      <div class="questionnaire-header">
        <h3 class="questionnaire-title">å®Œå–„ä¸ªäººä¿¡æ¯</h3>
        <button class="questionnaire-close" id="closeQuestionnaireModal">Ã—</button>
      </div>
      
      <form class="questionnaire-form" id="questionnaireForm">
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">æ˜Ÿåº§</label>
            <select id="xingzuo" class="form-input" required>
              <option value="">è¯·é€‰æ‹©æ˜Ÿåº§</option>
              <option value="ç™½ç¾Šåº§">â™ˆ ç™½ç¾Šåº§</option>
              <option value="é‡‘ç‰›åº§">â™‰ é‡‘ç‰›åº§</option>
              <option value="åŒå­åº§">â™Š åŒå­åº§</option>
              <option value="å·¨èŸ¹åº§">â™‹ å·¨èŸ¹åº§</option>
              <option value="ç‹®å­åº§">â™Œ ç‹®å­åº§</option>
              <option value="å¤„å¥³åº§">â™ å¤„å¥³åº§</option>
              <option value="å¤©ç§¤åº§">â™ å¤©ç§¤åº§</option>
              <option value="å¤©èåº§">â™ å¤©èåº§</option>
              <option value="å°„æ‰‹åº§">â™ å°„æ‰‹åº§</option>
              <option value="æ‘©ç¾¯åº§">â™‘ æ‘©ç¾¯åº§</option>
              <option value="æ°´ç“¶åº§">â™’ æ°´ç“¶åº§</option>
              <option value="åŒé±¼åº§">â™“ åŒé±¼åº§</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">MBTIæ€§æ ¼ç±»å‹</label>
            <select id="mbti" class="form-input" required>
              <option value="">è¯·é€‰æ‹©MBTI</option>
              <option value="INTJ">INTJ - å»ºç­‘å¸ˆ</option>
              <option value="INTP">INTP - æ€æƒ³å®¶</option>
              <option value="ENTJ">ENTJ - æŒ‡æŒ¥å®˜</option>
              <option value="ENTP">ENTP - è¾©è®ºå®¶</option>
              <option value="INFJ">INFJ - æå€¡è€…</option>
              <option value="INFP">INFP - è°ƒåœè€…</option>
              <option value="ENFJ">ENFJ - ä¸»äººå…¬</option>
              <option value="ENFP">ENFP - ç«é€‰è€…</option>
              <option value="ISTJ">ISTJ - ç‰©æµå¸ˆ</option>
              <option value="ISFJ">ISFJ - å®ˆæŠ¤è€…</option>
              <option value="ESTJ">ESTJ - æ€»ç»ç†</option>
              <option value="ESFJ">ESFJ - æ‰§æ”¿å®˜</option>
              <option value="ISTP">ISTP - é‰´èµå®¶</option>
              <option value="ISFP">ISFP - æ¢é™©å®¶</option>
              <option value="ESTP">ESTP - ä¼ä¸šå®¶</option>
              <option value="ESFP">ESFP - å¨±ä¹å®¶</option>
            </select>
          </div>
        </div>
        
        <div class="form-row single">
          <div class="form-group">
            <label class="form-label">å…´è¶£çˆ±å¥½</label>
            <input type="text" id="hobby" class="form-input" placeholder="è¯·è¾“å…¥ä½ çš„å…´è¶£çˆ±å¥½ï¼Œå¦‚ï¼šæ‰“ç‹è€…è£è€€" required>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">ç”Ÿæ´»ç†å¿µ</label>
            <select id="lifePhilosophy" class="form-input" required>
              <option value="">è¯·é€‰æ‹©ç”Ÿæ´»ç†å¿µ</option>
              <option value="1">æç®€ä¸»ä¹‰ - è¿½æ±‚ç®€å•ç”Ÿæ´»</option>
              <option value="2">å†’é™©æ¢ç´¢ - çƒ­çˆ±æŒ‘æˆ˜</option>
              <option value="3">ä¼ ç»Ÿä¿å®ˆ - é‡è§†ä¼ ç»Ÿä»·å€¼è§‚</option>
              <option value="4">ç²¾ç¥è¿½æ±‚ - æ³¨é‡å†…å¿ƒæˆé•¿</option>
              <option value="5">äº‹ä¸šå¯¼å‘ - ä»¥äº‹ä¸šä¸ºé‡</option>
              <option value="6">å®¶åº­è‡³ä¸Š - ä»¥å®¶åº­ä¸ºä¸­å¿ƒ</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç¤¾äº¤åå¥½</label>
            <select id="socialPreference" class="form-input" required>
              <option value="">è¯·é€‰æ‹©ç¤¾äº¤åå¥½</option>
              <option value="1">å°å›¢ä½“èšä¼š - 3-5äººäº²å¯†èšä¼š</option>
              <option value="2">å¤§å‹èšä¼š - çƒ­é—¹çš„æ´¾å¯¹</option>
              <option value="3">çº¿ä¸Šç¤¾äº¤ - ç½‘ç»œç¤¾äº¤ä¸ºä¸»</option>
              <option value="4">æˆ·å¤–æ´»åŠ¨ - æˆ·å¤–è¿åŠ¨ç¤¾äº¤</option>
              <option value="5">æ–‡åŒ–æ´»åŠ¨ - è‰ºæœ¯å±•è§ˆç­‰</option>
              <option value="6">èŒä¸šç¤¾äº¤ - å·¥ä½œç›¸å…³ç¤¾äº¤</option>
            </select>
          </div>
        </div>
        
        <div class="questionnaire-btn-group">
          <button type="button" onclick="submitQuestionnaire()" class="questionnaire-btn">
            <span class="btn-icon">ğŸš€</span>
            <span class="btn-text">æäº¤ä¿¡æ¯</span>
            <span class="btn-arrow">â†’</span>
          </button>
          <button type="button" onclick="hideQuestionnaireModal()" class="questionnaire-btn" style="background: #ccc;">
            <span class="btn-text">å–æ¶ˆ</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // åŠ è½½å¯¼èˆªæ 
    function loadNavbar() {
      fetch('navbar.html')
        .then(response => response.text())
        .then(html => {
          document.getElementById('navbar-container').innerHTML = html;
          
          // å¯¼èˆªæ åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
          const userAvatar = document.querySelector('.user-avatar');
          if (userAvatar) {
            userAvatar.addEventListener('click', function() {
              showUserModal();
            });
          }
        })
        .catch(error => {
          console.error('åŠ è½½å¯¼èˆªæ å¤±è´¥:', error);
        });
    }

    // åˆå§‹åŒ–å…´è¶£æ ‡ç­¾åŠŸèƒ½
    function initAllFeatures() {
      console.log('å¼€å§‹åˆå§‹åŒ–å…´è¶£æ ‡ç­¾åŠŸèƒ½...');
      
      console.log('åˆå§‹åŒ–å…´è¶£æ ‡ç­¾...');
      initInterestTags();
      
      console.log('å…´è¶£æ ‡ç­¾åŠŸèƒ½åˆå§‹åŒ–å®Œæˆï¼');
    }

    // DOMå†…å®¹åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOMå†…å®¹åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–åŠŸèƒ½');
      
      // æ£€æŸ¥å…´è¶£æ ‡ç­¾å…ƒç´ æ˜¯å¦å­˜åœ¨
      console.log('æ£€æŸ¥å…´è¶£æ ‡ç­¾å…ƒç´ :');
      console.log('- å…´è¶£æ ‡ç­¾:', document.querySelectorAll('.tag').length);
      
      initAllFeatures();
    });

    // é¡µé¢åŠ è½½å®Œæˆåéšè—åŠ è½½åŠ¨ç”»
    window.addEventListener('load', () => {
      const loading = document.getElementById('loading');
      setTimeout(() => {
        loading.classList.add('hidden');
      }, 1000);

      // åŠ è½½å¯¼èˆªæ 
      loadNavbar();
      
      // å»¶è¿Ÿåˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½ï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
      setTimeout(() => {
        initAllFeatures();
      }, 100);

      // å…³é—­å¼¹çª—äº‹ä»¶
      document.getElementById('closeModal').addEventListener('click', function() {
        hideUserModal();
      });

      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      document.getElementById('userModal').addEventListener('click', function(e) {
        if (e.target === this) {
          hideUserModal();
        }
      });
    });

    // Lenis å¹³æ»‘æ»šåŠ¨ - æ·»åŠ é”™è¯¯å¤„ç†
    let lenis;
    try {
      if (typeof Lenis !== 'undefined') {
        lenis = new Lenis({
          duration: 1.2,
          easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
          direction: 'vertical',
          gestureDirection: 'vertical',
          smooth: true,
          mouseMultiplier: 1,
          smoothTouch: false,
          touchMultiplier: 2,
          infinite: false,
        });

        function raf(time) {
          if (lenis) {
            lenis.raf(time);
            requestAnimationFrame(raf);
          }
        }
        requestAnimationFrame(raf);
      } else {
        console.log('Lenisåº“æœªåŠ è½½ï¼Œè·³è¿‡å¹³æ»‘æ»šåŠ¨');
      }
    } catch (error) {
      console.log('Lenisåˆå§‹åŒ–å¤±è´¥:', error);
    }

    // GSAP åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
    try {
      if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
        gsap.registerPlugin(ScrollTrigger);
        console.log('GSAPå’ŒScrollTriggeråŠ è½½æˆåŠŸ');
      } else {
        console.log('GSAPæˆ–ScrollTriggeræœªåŠ è½½ï¼Œè·³è¿‡åŠ¨ç”»åŠŸèƒ½');
      }
    } catch (error) {
      console.log('GSAPåˆå§‹åŒ–å¤±è´¥:', error);
    }

    // è‡ªå®šä¹‰ç¼“åŠ¨å‡½æ•°
    if (typeof gsap !== 'undefined') {
      gsap.registerEase('smoothStep', p => p * p * (3 - 2 * p));
    }

    // åˆ›å»ºç²’å­èƒŒæ™¯
    function createParticles() {
      const particlesBg = document.getElementById('particlesBg');
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 20 + 's';
        particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
        particlesBg.appendChild(particle);
      }
    }

    createParticles();

    // æ­¥éª¤å¡ç‰‡åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
    try {
      if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
        gsap.from('.step-card', {
          scrollTrigger: {
            trigger: '.data-input-section',
            start: 'top 80%',
            end: 'bottom 20%',
            toggleActions: 'play none none reverse'
          },
          duration: 1.2,
          y: 100,
          opacity: 0,
          ease: 'smoothStep',
          stagger: 0.3
        });
        console.log('æ­¥éª¤å¡ç‰‡åŠ¨ç”»åˆå§‹åŒ–æˆåŠŸ');
      } else {
        console.log('è·³è¿‡æ­¥éª¤å¡ç‰‡åŠ¨ç”»ï¼ˆGSAPæœªåŠ è½½ï¼‰');
      }
    } catch (error) {
      console.log('æ­¥éª¤å¡ç‰‡åŠ¨ç”»åˆå§‹åŒ–å¤±è´¥:', error);
    }

    // å…´è¶£æ ‡ç­¾ç‚¹å‡»æ•ˆæœ
    function initInterestTags() {
      console.log('æ‰¾åˆ°å…´è¶£æ ‡ç­¾æ•°é‡:', document.querySelectorAll('.tag').length);
      document.querySelectorAll('.tag').forEach(tag => {
        tag.addEventListener('click', function() {
          this.classList.toggle('selected');
          
          // å¼¹è·³åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.3,
                scale: 1.2,
                ease: 'back.out(1.7)',
                yoyo: true,
                repeat: 1
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'scale(1.2)';
              setTimeout(() => {
                this.style.transform = 'scale(1)';
              }, 300);
            }
          } catch (error) {
            console.log('å…´è¶£æ ‡ç­¾åŠ¨ç”»å¤±è´¥:', error);
          }
        });
      });
    }

    // æ€§æ ¼é€‰é¡¹ç‚¹å‡»æ•ˆæœ
    function initPersonalityOptions() {
      console.log('æ‰¾åˆ°æ€§æ ¼é€‰é¡¹æ•°é‡:', document.querySelectorAll('.personality-option').length);
      document.querySelectorAll('.personality-option').forEach(option => {
        option.addEventListener('click', function() {
          // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('.personality-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          // 3Dç¿»è½¬æ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.5,
                rotationY: 360,
                ease: 'power2.out'
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'rotateY(360deg)';
              setTimeout(() => {
                this.style.transform = 'rotateY(0deg)';
              }, 500);
            }
          } catch (error) {
            console.log('æ€§æ ¼é€‰é¡¹åŠ¨ç”»å¤±è´¥:', error);
          }
        });
      });
    }

    // æ˜Ÿåº§é€‰æ‹©ç‚¹å‡»æ•ˆæœ
    function initConstellationOptions() {
      console.log('æ‰¾åˆ°æ˜Ÿåº§é€‰é¡¹æ•°é‡:', document.querySelectorAll('.constellation-option').length);
      document.querySelectorAll('.constellation-option').forEach(option => {
        option.addEventListener('click', function() {
          // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('.constellation-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          // å¼¹è·³åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.3,
                scale: 1.1,
                ease: 'back.out(1.7)',
                yoyo: true,
                repeat: 1
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'scale(1.1)';
              setTimeout(() => {
                this.style.transform = 'scale(1)';
              }, 300);
            }
          } catch (error) {
            console.log('æ˜Ÿåº§é€‰é¡¹åŠ¨ç”»å¤±è´¥:', error);
          }

          // å¦‚æœæ˜¯"å…¶ä»–"é€‰é¡¹ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
          if (this.classList.contains('other-option')) {
            const input = this.querySelector('.other-input');
            input.style.display = 'block';
            input.focus();
          }
        });
      });
    }

    // ç”Ÿæ´»ç†å¿µé€‰æ‹©ç‚¹å‡»æ•ˆæœ
    function initLifestyleOptions() {
      console.log('æ‰¾åˆ°ç”Ÿæ´»ç†å¿µé€‰é¡¹æ•°é‡:', document.querySelectorAll('.lifestyle-option').length);
      document.querySelectorAll('.lifestyle-option').forEach(option => {
        option.addEventListener('click', function() {
          // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('.lifestyle-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          // å‘ä¸Šæµ®åŠ¨æ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.3,
                y: -5,
                ease: 'power2.out'
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'translateY(-5px)';
              setTimeout(() => {
                this.style.transform = 'translateY(0)';
              }, 300);
            }
          } catch (error) {
            console.log('ç”Ÿæ´»ç†å¿µåŠ¨ç”»å¤±è´¥:', error);
          }

          // å¦‚æœæ˜¯"å…¶ä»–"é€‰é¡¹ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
          if (this.classList.contains('other-option')) {
            const input = this.querySelector('.other-input');
            input.style.display = 'block';
            input.focus();
          }
        });
      });
    }

    // ç¤¾äº¤åå¥½é€‰æ‹©ç‚¹å‡»æ•ˆæœ
    function initSocialOptions() {
      console.log('æ‰¾åˆ°ç¤¾äº¤åå¥½é€‰é¡¹æ•°é‡:', document.querySelectorAll('.social-option').length);
      document.querySelectorAll('.social-option').forEach(option => {
        option.addEventListener('click', function() {
          // ç§»é™¤å…¶ä»–é€‰ä¸­çŠ¶æ€
          document.querySelectorAll('.social-option').forEach(opt => opt.classList.remove('selected'));
          this.classList.add('selected');
          
          // å‘ä¸Šæµ®åŠ¨æ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.3,
                y: -5,
                ease: 'power2.out'
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'translateY(-5px)';
              setTimeout(() => {
                this.style.transform = 'translateY(0)';
              }, 300);
            }
          } catch (error) {
            console.log('ç¤¾äº¤åå¥½åŠ¨ç”»å¤±è´¥:', error);
          }

          // å¦‚æœæ˜¯"å…¶ä»–"é€‰é¡¹ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
          if (this.classList.contains('other-option')) {
            const input = this.querySelector('.other-input');
            input.style.display = 'block';
            input.focus();
          }
        });
      });
    }

    // å…¶ä»–è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹æ—¶éšè—ï¼ˆå¦‚æœæ²¡æœ‰å†…å®¹ï¼‰
    function initOtherInputs() {
      document.querySelectorAll('.other-input').forEach(input => {
        input.addEventListener('blur', function() {
          if (!this.value.trim()) {
            this.style.display = 'none';
            this.parentElement.classList.remove('selected');
          }
        });

        input.addEventListener('input', function() {
          if (this.value.trim()) {
            this.parentElement.classList.add('selected');
          }
        });
      });
    }

    // è¯­éŸ³å½•åˆ¶æŒ‰é’®
    function initVoiceUpload() {
      const voiceUpload = document.getElementById('voiceUpload');
      if (voiceUpload) {
        voiceUpload.addEventListener('click', function() {
          // æ¨¡æ‹Ÿå½•åˆ¶åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
          try {
            const waveBars = this.querySelectorAll('.wave-bar');
            if (typeof gsap !== 'undefined') {
              waveBars.forEach((bar, index) => {
                gsap.to(bar, {
                  duration: 0.5,
                  scaleY: Math.random() * 2 + 0.5,
                  ease: 'power2.out',
                  repeat: -1,
                  yoyo: true,
                  delay: index * 0.1
                });
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              waveBars.forEach((bar, index) => {
                bar.style.animation = `wave-animation 1.5s ease-in-out infinite`;
                bar.style.animationDelay = `${index * 0.1}s`;
              });
            }
          } catch (error) {
            console.log('è¯­éŸ³å½•åˆ¶åŠ¨ç”»å¤±è´¥:', error);
          }
        });
      }
    }

    // åŒ¹é…ç®—æ³•æ¨¡æ‹Ÿ
    function startMatching() {
      const startMatchBtn = document.getElementById('startMatchBtn');
      const matchPercentage = document.getElementById('matchPercentage');
      const matchDescription = document.getElementById('matchDescription');
      const soulSphere = document.getElementById('soulSphere');

      startMatchBtn.style.display = 'inline-block';
      
      // æ•°å­—åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
      try {
        if (typeof gsap !== 'undefined') {
          gsap.to({ value: 0 }, {
            value: 92,
            duration: 3,
            ease: 'power2.out',
            onUpdate: function() {
              matchPercentage.textContent = Math.round(this.targets()[0].value) + '%';
            }
          });
        } else {
          // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨ç®€å•çš„æ•°å­—é€’å¢åŠ¨ç”»
          let currentValue = 0;
          const increment = 92 / 30; // 30å¸§åŠ¨ç”»
          const timer = setInterval(() => {
            currentValue += increment;
            if (currentValue >= 92) {
              currentValue = 92;
              clearInterval(timer);
            }
            matchPercentage.textContent = Math.round(currentValue) + '%';
          }, 100);
        }
      } catch (error) {
        console.log('æ•°å­—åŠ¨ç”»å¤±è´¥:', error);
      }

      // æè¿°æ–‡å­—åŠ¨ç”»
      setTimeout(() => {
        matchDescription.textContent = 'ä½ ä¸ Alex çš„çµé­‚å¥‘åˆåº¦ä¸º 92%ï¼Œä½ ä»¬éƒ½çƒ­çˆ±æ·±å¤œçš„éŸ³ä¹ä¸å®‰é™çš„ä¹¦åº—ã€‚';
      }, 1500);

      // çµé­‚çƒä½“åŠ¨ç”» - æ·»åŠ é”™è¯¯å¤„ç†
      try {
        if (typeof gsap !== 'undefined') {
          gsap.to(soulSphere, {
            duration: 2,
            scale: 1.2,
            ease: 'back.out(1.7)',
            repeat: 1,
            yoyo: true
          });
        } else {
          // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
          soulSphere.style.transform = 'scale(1.2)';
          setTimeout(() => {
            soulSphere.style.transform = 'scale(1)';
          }, 2000);
        }
      } catch (error) {
        console.log('çµé­‚çƒä½“åŠ¨ç”»å¤±è´¥:', error);
      }
    }

    // å¼€å§‹åŒ¹é…æŒ‰é’® - æ·»åŠ é”™è¯¯å¤„ç†
    const startMatchBtn = document.getElementById('startMatchBtn');
    if (startMatchBtn) {
      startMatchBtn.addEventListener('click', startMatching);
    }

    // æ¨èé¡¹ç›®æ‚¬åœæ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
    const recommendationItems = document.querySelectorAll('.recommendation-item');
    if (recommendationItems.length > 0) {
      recommendationItems.forEach(item => {
        item.addEventListener('mouseenter', () => {
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(item, {
                duration: 0.3,
                scale: 1.05,
                ease: 'power2.out'
              });
            } else {
              item.style.transform = 'scale(1.05)';
            }
          } catch (error) {
            console.log('æ¨èé¡¹ç›®æ‚¬åœåŠ¨ç”»å¤±è´¥:', error);
          }
        });

        item.addEventListener('mouseleave', () => {
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(item, {
                duration: 0.3,
                scale: 1,
                ease: 'power2.out'
              });
            } else {
              item.style.transform = 'scale(1)';
            }
          } catch (error) {
            console.log('æ¨èé¡¹ç›®æ‚¬åœåŠ¨ç”»å¤±è´¥:', error);
          }
        });
      });
    }

    // è¯é¢˜æ ‡ç­¾ç‚¹å‡»æ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
    const topicTags = document.querySelectorAll('.topic-tag');
    if (topicTags.length > 0) {
      topicTags.forEach(tag => {
        tag.addEventListener('click', function() {
          try {
            if (typeof gsap !== 'undefined') {
              gsap.to(this, {
                duration: 0.3,
                scale: 1.2,
                ease: 'back.out(1.7)',
                yoyo: true,
                repeat: 1
              });
            } else {
              // å¦‚æœGSAPä¸å¯ç”¨ï¼Œä½¿ç”¨CSSåŠ¨ç”»
              this.style.transform = 'scale(1.2)';
              setTimeout(() => {
                this.style.transform = 'scale(1)';
              }, 300);
            }
          } catch (error) {
            console.log('è¯é¢˜æ ‡ç­¾åŠ¨ç”»å¤±è´¥:', error);
          }
        });
      });
    }

    // å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ - æ·»åŠ é”™è¯¯å¤„ç†
    window.addEventListener('scroll', () => {
      const navbar = document.querySelector('.navbar');
      if (navbar) {
        if (window.scrollY > 100) {
          navbar.style.background = 'rgba(255, 255, 255, 0.95)';
          navbar.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.1)';
        } else {
          navbar.style.background = 'rgba(255, 255, 255, 0.1)';
          navbar.style.boxShadow = 'none';
        }
      }
    });

    // å¹³æ»‘é”šç‚¹æ»šåŠ¨ - æ·»åŠ é”™è¯¯å¤„ç†
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    if (anchorLinks.length > 0) {
      anchorLinks.forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            if (lenis) {
              lenis.scrollTo(target, {
                duration: 1.5,
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t))
              });
            } else {
              // å¦‚æœLenisä¸å¯ç”¨ï¼Œä½¿ç”¨åŸç”Ÿæ»šåŠ¨
              target.scrollIntoView({ behavior: 'smooth' });
            }
          }
        });
      });
    }

    // è‡ªåŠ¨å¼€å§‹åŒ¹é…æ¼”ç¤ºï¼ˆ5ç§’åï¼‰ - æ·»åŠ é”™è¯¯å¤„ç†
    setTimeout(() => {
      try {
        startMatching();
      } catch (error) {
        console.log('è‡ªåŠ¨åŒ¹é…æ¼”ç¤ºå¤±è´¥:', error);
      }
    }, 5000);

    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯å¼¹çª—
    function showUserModal(isAutoOpen = false) {
      console.log('showUserModalè¢«è°ƒç”¨ï¼ŒisAutoOpen:', isAutoOpen);
      const modal = document.getElementById('userModal');
      const content = document.getElementById('userInfoContent');
      
      if (!modal) {
        console.log('å¼¹çª—å…ƒç´ æœªæ‰¾åˆ°');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦æœ‰token
      const token = localStorage.getItem('Authorization');
      const userId = localStorage.getItem('X-User-Id');
      
      if (!token || !userId) {
        content.innerHTML = `
          <div class="error-message">
            è¯·å…ˆç™»å½•
          </div>
        `;
        modal.classList.add('show');
        return;
      }
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      let loadingText = 'æ­£åœ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯...';
      if (isAutoOpen) {
        loadingText = 'æ£€æµ‹åˆ°æ‚¨éœ€è¦å®Œå–„ä¸ªäººä¿¡æ¯ï¼Œæ­£åœ¨åŠ è½½...';
      }
      
      content.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <div class="loading-spinner"></div>
          <p style="margin-top: 20px; color: #666;">${loadingText}</p>
        </div>
      `;
      
      modal.classList.add('show');
      
      // è·å–ç”¨æˆ·ä¿¡æ¯
      fetchUserInfo();
    }

    // éšè—ç”¨æˆ·ä¿¡æ¯å¼¹çª—
    function hideUserModal() {
      const modal = document.getElementById('userModal');
      modal.classList.remove('show');
      
      // æ¸…é™¤countå€¼ï¼Œé¿å…é‡å¤å¼¹å‡º
      localStorage.removeItem('count');
    }

    // è·å–ç”¨æˆ·ä¿¡æ¯
    function fetchUserInfo() {
      // ä»localStorageè·å–Authorization token
      const token = localStorage.getItem('Authorization');
      const userId = localStorage.getItem('X-User-Id');
      
      console.log('è·å–åˆ°çš„token:', token);
      console.log('è·å–åˆ°çš„userId:', userId);
      
      if (!token || !userId) {
        console.log('tokenæˆ–userIdä¸ºç©º');
        showError('è¯·å…ˆç™»å½•');
        return;
      }



      // å°è¯•ä¸åŒçš„Authorizationæ ¼å¼
      const authHeader = token.startsWith('Bearer ') ? token : `Bearer ${token}`;
      
      // å°è¯•ä¸ä½¿ç”¨Bearerå‰ç¼€ï¼Œç›´æ¥ä½¿ç”¨token
      fetch(`http://127.0.0.1:9090/information/${userId}`, {
        method: 'GET',
        headers: {
          'Authorization': token,
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
      })
      .then(data => {
        displayUserInfo(data);
      });
    }

    // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
    function displayUserInfo(userData) {
      const content = document.getElementById('userInfoContent');
      
      content.innerHTML = `
        <form id="userInfoForm" enctype="multipart/form-data">
          <div style="text-align: center; margin-bottom: 30px;">
            <div style="position: relative; display: inline-block;">
              <img id="avatarPreview" src="${userData.image}" alt="ç”¨æˆ·å¤´åƒ" class="user-avatar-large" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjVGNUY1Ii8+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNDAiIHI9IjE1IiBmaWxsPSIjQ0NDQ0NDIi8+CjxwYXRoIGQ9Ik0yNSA3NUMyNSA2NS4zMzU4IDMyLjMzNTggNTggNDIgNThINjBDNjkuNjY0MiA1OCA3NyA2NS4zMzU4IDc3IDc1VjgwSDI1Vjc1WiIgZmlsbD0iI0NDQ0NDQyIvPgo8L3N2Zz4K'">
              <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)" required>
              <button type="button" onclick="document.getElementById('imageUpload').click()" style="position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; border-radius: 50%; background: #6E8BFF; border: none; color: white; cursor: pointer; font-size: 16px;">ğŸ“·</button>
            </div>
            <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">ç‚¹å‡»ç›¸æœºå›¾æ ‡é€‰æ‹©å¤´åƒå›¾ç‰‡ï¼ˆå¿…å¡«ï¼‰</p>
          </div>
          
          <div class="form-group">
            <label class="form-label">å§“å</label>
            <input type="text" id="userName" class="form-input" 
       value="${userData.name != null ? userData.name : ''}" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">æ€§åˆ«</label>
            <select id="userGender" class="form-input" required>
              <option value="1" ${userData.gender === 1 ? 'selected' : ''}>ç”·</option>
              <option value="0" ${userData.gender === 0 ? 'selected' : ''}>å¥³</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">å¹´é¾„</label>
            <input type="number" id="userAge" class="form-input" value="${userData.age}" min="1" max="120" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">èŒä½</label>
            <select id="userPosition" class="form-input" required>
              <option value="1" ${userData.position === 1 ? 'selected' : ''}>å­¦ç”Ÿ</option>
              <option value="2" ${userData.position === 2 ? 'selected' : ''}>ä¸Šç­æ—</option>
              <option value="3" ${userData.position === 3 ? 'selected' : ''}>è‡ªç”±èŒä¸šè€…</option>
              <option value="4" ${userData.position === 4 ? 'selected' : ''}>åˆ›ä¸šè€…</option>
              <option value="5" ${userData.position === 5 ? 'selected' : ''}>å…¶ä»–</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">åœ°åŒº</label>
            <input type="text" id="userRegion" class="form-input" value="${userData.region != null ? userData.region : ''}" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">ä¸ªäººä»‹ç»</label>
            <textarea id="userIntroduce" class="form-input" rows="3" placeholder="è¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±...">${userData.introduce != null ? userData.introduce : ''}</textarea>
          </div>
          
          <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="button" onclick="saveUserInfo()" class="login-btn" style="flex: 1; margin: 0;">ä¿å­˜ä¿®æ”¹</button>
            <button type="button" onclick="hideUserModal()" class="login-btn" style="flex: 1; margin: 0; background: #ccc;">å–æ¶ˆ</button>
          </div>
        </form>
      `;
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(message) {
      const content = document.getElementById('userInfoContent');
      content.innerHTML = `
        <div class="error-message">
          ${message}
        </div>
      `;
    }

    // è·å–èŒä½æ–‡æœ¬
    function getPositionText(position) {
      const positionMap = {
        1: 'å­¦ç”Ÿ',
        2: 'ä¸Šç­æ—',
        3: 'è‡ªç”±èŒä¸šè€…',
        4: 'åˆ›ä¸šè€…',
        5: 'å…¶ä»–'
      };
      return positionMap[position] || 'æœªçŸ¥';
    }

    // æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†
function showFileUploadModal() {
  const modal = document.getElementById('fileUploadModal');
  modal.classList.add('show');
}

// éšè—æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†
function hideFileUploadModal() {
  const modal = document.getElementById('fileUploadModal');
  modal.classList.remove('show');
}
// ä¸Šä¼ æ–‡ä»¶å‡½æ•°
async function uploadVoiceFile() {
  const fileInput = document.getElementById('voiceFile');
  const file = fileInput.files[0];
  
  if (!file) {
    alert('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„PDFæ–‡ä»¶');
    return;
  }
  
  // æ£€æŸ¥æ–‡ä»¶ç±»å‹ (ä»…å…è®¸PDFæ–‡ä»¶)
  if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
    alert('ä»…æ”¯æŒPDFæ ¼å¼çš„æ–‡ä»¶');
    fileInput.value = ''; // æ¸…ç©ºé€‰æ‹©
    return;
  }
  
  // æ£€æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶ä¸º10MB)
  if (file.size > 10 * 1024 * 1024) {
    alert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
    return;
  }
  
  // è·å–ç”¨æˆ·ID
  const userId = localStorage.getItem('X-User-Id');
  if (!userId) {
    alert('ç”¨æˆ·æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•');
    return;
  }
  
  // æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€
  const submitBtn = document.getElementById('submitVoiceFile');
  const originalHTML = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="btn-icon">â³</span><span class="btn-text">ä¸Šä¼ ä¸­...</span>';
  submitBtn.disabled = true;
  
  try {
    const formData = new FormData();
    formData.append('userId', userId);
    formData.append('file', file);
    
    const response = await fetch('http://127.0.0.1:9090/file/upload', {
      method: 'POST',
      headers: {
        'Authorization': localStorage.getItem('Authorization') || ''
      },
      body: formData
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const result = await response.json();
    // alert('æ€§æ ¼æŠ¥å‘Šä¸Šä¼ æˆåŠŸï¼');
    
    // ä¸Šä¼ æˆåŠŸåè°ƒç”¨AIåˆ†ææ¥å£
    await analyzePersonalityReport(userId);
    
  } catch (error) {
    console.error('æ–‡ä»¶ä¸Šä¼ å¤±è´¥:', error);
    alert('æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š' + error.message);
  } finally {
    submitBtn.innerHTML = originalHTML;
    submitBtn.disabled = false;
  }
}

// AIåˆ†ææ€§æ ¼æŠ¥å‘Šå‡½æ•°
async function analyzePersonalityReport(userId) {
  const analysisContent = document.getElementById('analysisContent');
  const analysisLoading = document.getElementById('analysisLoading');
  const aiAnalysisResult = document.getElementById('aiAnalysisResult');
  
  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  analysisContent.style.display = 'none';
  analysisLoading.style.display = 'block';
  aiAnalysisResult.style.display = 'block';
  
  try {
    // å°†userIdä½œä¸ºæŸ¥è¯¢å‚æ•°ä¼ é€’
    const response = await fetch(`http://127.0.0.1:9090/file/get?userId=${encodeURIComponent(userId)}`, {
      method: 'POST',
      headers: {
        'Authorization': localStorage.getItem('Authorization') || '',
        'Content-Type': 'application/json'
      }
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    const result = await response.text();
    
    // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºç»“æœ
    analysisLoading.style.display = 'none';
    analysisContent.style.display = 'block';
    
    // æ˜¾ç¤ºåˆ†æç»“æœ
    if (result) {
      analysisContent.innerHTML = `
        <div style="white-space: pre-wrap; background: rgba(0, 0, 0, 0.2); border-radius: 10px; padding: 15px; margin-top: 10px;">
          ${result}
        </div>
      `;
    } else {
      analysisContent.innerHTML = '<p>AIåˆ†æå®Œæˆï¼Œä½†æœªè¿”å›å…·ä½“ç»“æœã€‚</p>';
    }
    
    // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
    aiAnalysisResult.scrollIntoView({ behavior: 'smooth' });
    
  } catch (error) {
    console.error('AIåˆ†æå¤±è´¥:', error);
    analysisLoading.style.display = 'none';
    analysisContent.style.display = 'block';
    analysisContent.innerHTML = `<p style="color: #ff6b6b;">AIåˆ†æå¤±è´¥ï¼š${error.message}</p>`;
  }
}

    // æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œè‡ªåŠ¨å¼¹å‡ºå¼¹çª—çš„å‡½æ•°
    function checkLoginAndAutoOpen() {
      const token = localStorage.getItem('Authorization');
      const userId = localStorage.getItem('X-User-Id');
      const count = localStorage.getItem('count');
  
      
      if (!token || !userId) {
        // å¦‚æœæ²¡æœ‰ç™»å½•ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
        console.log('ç™»å½•ä¿¡æ¯ä¸å®Œæ•´ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢');
        window.location.href = 'login.html';
        return;
      }
      
      // æ£€æŸ¥countå€¼ï¼Œå¦‚æœä¸º1åˆ™è‡ªåŠ¨å¼¹å‡ºç”¨æˆ·ä¿¡æ¯å¼¹çª—
      if (count === '1') {
        console.log('æ£€æµ‹ä¸ºæ–°ç”¨æˆ·ï¼Œè‡ªåŠ¨å¼¹å‡ºç”¨æˆ·ä¿¡æ¯å¼¹çª—');
        // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        setTimeout(() => {
          console.log('å¼€å§‹æ‰§è¡Œè‡ªåŠ¨å¼¹å‡ºå¼¹çª—');
          showUserModal(true); // ä¼ å…¥trueè¡¨ç¤ºæ˜¯è‡ªåŠ¨å¼¹å‡º
        }, 1000);
      } else {
        console.log('countå€¼ä¸æ˜¯1ï¼Œä¸è‡ªåŠ¨å¼¹å‡ºå¼¹çª—ã€‚å½“å‰countå€¼:', count);
      }
    }

    // ç«‹å³æ£€æŸ¥ä¸€æ¬¡ï¼ˆé˜²æ­¢å…¶ä»–é”™è¯¯é˜»æ­¢loadäº‹ä»¶ï¼‰
    checkLoginAndAutoOpen();
    
    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
    window.addEventListener('load', checkLoginAndAutoOpen);
    
    // å¤‡ç”¨æ£€æŸ¥æœºåˆ¶ - å¦‚æœloadäº‹ä»¶æ²¡æœ‰è§¦å‘
    setTimeout(checkLoginAndAutoOpen, 2000);
    
    // å†æ¬¡æ£€æŸ¥ - ç¡®ä¿ä¸ä¼šé—æ¼
    setTimeout(checkLoginAndAutoOpen, 5000);
    
    // æµ‹è¯•å‡½æ•° - ç‚¹å‡»è®¾ç½®æŒ‰é’®å¯ä»¥æ‰‹åŠ¨æµ‹è¯•å¼¹çª—
    function testModal() {
      console.log('æ‰‹åŠ¨æµ‹è¯•å¼¹çª—');
      showUserModal(true);
    }
    
    // å°†æµ‹è¯•å‡½æ•°è®¾ä¸ºå…¨å±€ï¼Œæ–¹ä¾¿è°ƒè¯•
    window.testModal = testModal;
    
    // å›¾ç‰‡ä¸Šä¼ å¤„ç†
    function handleImageUpload(event) {
      const file = event.target.files[0];
      if (file) {
        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        if (!file.type.startsWith('image/')) {
          alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
          event.target.value = ''; // æ¸…ç©ºé€‰æ‹©
          return;
        }
        
        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆé™åˆ¶ä¸º5MBï¼‰
        if (file.size > 5 * 1024 * 1024) {
          alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
          event.target.value = ''; // æ¸…ç©ºé€‰æ‹©
          return;
        }
        
        // é¢„è§ˆå›¾ç‰‡
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('avatarPreview');
          if (preview) {
            preview.src = e.target.result;
          }
        };
        reader.readAsDataURL(file);
        
        console.log('å¤´åƒæ–‡ä»¶å·²é€‰æ‹©:', file.name, 'å¤§å°:', file.size, 'ç±»å‹:', file.type);
      } else {
        console.log('æœªé€‰æ‹©æ–‡ä»¶');
      }
    }
    
    // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
    function saveUserInfo() {
      const form = document.getElementById('userInfoForm');
      if (!form) {
        alert('è¡¨å•æœªæ‰¾åˆ°');
        return;
      }
      
      // è·å–è¡¨å•æ•°æ®
      const name = document.getElementById('userName').value.trim();
      const gender = parseInt(document.getElementById('userGender').value);
      const age = parseInt(document.getElementById('userAge').value);
      const position = parseInt(document.getElementById('userPosition').value);
      const region = document.getElementById('userRegion').value.trim();
      const introduce = document.getElementById('userIntroduce').value.trim();
      const imageFile = document.getElementById('imageUpload').files[0];
      
      // è¡¨å•éªŒè¯
      if (!name) {
        alert('è¯·è¾“å…¥å§“å');
        return;
      }
      if (!age || age < 1 || age > 120) {
        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¹´é¾„ï¼ˆ1-120ï¼‰');
        return;
      }
      if (!region) {
        alert('è¯·è¾“å…¥åœ°åŒº');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†å¤´åƒæ–‡ä»¶
      if (!imageFile) {
        alert('è¯·é€‰æ‹©å¤´åƒå›¾ç‰‡');
        return;
      }
      
      // è·å–token
      const token = localStorage.getItem('Authorization');
      if (!token) {
        alert('è¯·å…ˆç™»å½•');
        return;
      }
      
      // æ˜¾ç¤ºä¿å­˜çŠ¶æ€
      const saveBtn = form.querySelector('button[onclick="saveUserInfo()"]');
      const originalText = saveBtn.textContent;
      saveBtn.textContent = 'ä¿å­˜ä¸­...';
      saveBtn.disabled = true;
      
      // æ„å»ºFormData - æŒ‰ç…§æ–°çš„æ¥å£æ ¼å¼
      const formData = new FormData();
      
      // æ·»åŠ å¤´åƒæ–‡ä»¶ï¼ˆå¿…å¡«ï¼‰
      formData.append('file', imageFile);
      
      // æ·»åŠ å…¶ä»–æ•°æ®ä½œä¸ºInformationå¯¹è±¡çš„å±æ€§
      formData.append('name', name);
      formData.append('gender', gender);
      formData.append('age', age);
      formData.append('position', position);
      formData.append('region', region);
      formData.append('introduce', introduce);
      
      console.log('å‘é€çš„æ•°æ®:', {
        file: imageFile.name,
        name: name,
        gender: gender,
        age: age,
        position: position,
        region: region,
        introduce: introduce
      });
      
      // å‘é€è¯·æ±‚
      fetch('http://127.0.0.1:9090/upload', {
        method: 'PUT',
        headers: {
          'Authorization': token
        },
        body: formData
      })
      .then(response => {
        console.log('å“åº”çŠ¶æ€:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('ä¿å­˜æˆåŠŸ:', data);
        alert('ä¿å­˜æˆåŠŸï¼');
        hideUserModal();
      })
      .catch(error => {
        console.error('ä¿å­˜å¤±è´¥:', error);
        alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
      })
      .finally(() => {
        saveBtn.textContent = originalText;
        saveBtn.disabled = false;
      });
    }
    
    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€ï¼Œæ–¹ä¾¿HTMLè°ƒç”¨
    window.handleImageUpload = handleImageUpload;
    window.saveUserInfo = saveUserInfo;
    window.showQuestionnaireModal = showQuestionnaireModal;
    window.hideQuestionnaireModal = hideQuestionnaireModal;
    window.submitQuestionnaire = submitQuestionnaire;

    // æ˜¾ç¤ºé—®å·å¼¹çª—
    function showQuestionnaireModal() {
      const modal = document.getElementById('questionnaireModal');
      modal.classList.add('show');
    }

    // éšè—é—®å·å¼¹çª—
    function hideQuestionnaireModal() {
      const modal = document.getElementById('questionnaireModal');
      modal.classList.remove('show');
    }

    // æäº¤é—®å·
    function submitQuestionnaire() {
      const form = document.getElementById('questionnaireForm');
      if (!form) {
        alert('è¡¨å•æœªæ‰¾åˆ°');
        return;
      }

      // è·å–è¡¨å•æ•°æ®
      const xingzuo = document.getElementById('xingzuo').value.trim();
      const mbti = document.getElementById('mbti').value.trim();
      const hobby = document.getElementById('hobby').value.trim();
      const lifePhilosophy = parseInt(document.getElementById('lifePhilosophy').value);
      const socialPreference = parseInt(document.getElementById('socialPreference').value);

      // è¡¨å•éªŒè¯
      if (!xingzuo || !mbti || !hobby || !lifePhilosophy || !socialPreference) {
        alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹');
        return;
      }

      // è·å–token
      const token = localStorage.getItem('Authorization');
      if (!token) {
        alert('è¯·å…ˆç™»å½•');
        return;
      }

      // æ˜¾ç¤ºæäº¤çŠ¶æ€
      const submitBtn = form.querySelector('button[onclick="submitQuestionnaire()"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="btn-icon">â³</span><span class="btn-text">æäº¤ä¸­...</span>';
      submitBtn.disabled = true;

      // æ„å»ºè¯·æ±‚æ•°æ®
      const requestData = {
        xingzuo: xingzuo,
        mbti: mbti,
        hobby: hobby,
        lifePhilosophy: lifePhilosophy,
        socialPreference: socialPreference
      };

      console.log('å‘é€é—®å·æ•°æ®:', requestData);

      // å‘é€è¯·æ±‚
      fetch('http://127.0.0.1:9090/data', {
        method: 'POST',
        headers: {
          'Authorization': token,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
      })
      .then(response => {
        console.log('å“åº”çŠ¶æ€:', response.status);
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        return response.json();
      })
      .then(data => {
        console.log('é—®å·æäº¤æˆåŠŸ:', data);
        alert('ä¿¡æ¯æäº¤æˆåŠŸï¼');
        hideQuestionnaireModal();
        updateRecommendationPanel(data);
      })
      .catch(error => {
        console.error('é—®å·æäº¤å¤±è´¥:', error);
        alert('æäº¤å¤±è´¥ï¼š' + error.message);
      })
      .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      });
    }

    // æ›´æ–°æ¨èé¢æ¿
    function updateRecommendationPanel(userData) {
      const recommendationContent = document.getElementById('recommendationContent');
      
      if (!userData) {
        recommendationContent.innerHTML = `
          <div style="text-align: center; padding: 40px; color: rgba(255, 255, 255, 0.7);">
            <div style="font-size: 3rem; margin-bottom: 20px;">ğŸ”</div>
            <p>å®Œå–„ä¸ªäººä¿¡æ¯åï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æ¨èå¿—åŒé“åˆçš„æœ‹å‹</p>
            <button class="questionnaire-btn" onclick="showQuestionnaireModal()" style="margin-top: 20px;">
              <span class="btn-icon">ğŸ“‹</span>
              <span class="btn-text">å¼€å§‹åŒ¹é…</span>
              <span class="btn-arrow">â†’</span>
            </button>
          </div>
        `;
        return;
      }

      // ç”Ÿæˆæ¨èå†…å®¹
      recommendationContent.innerHTML = `
        <div class="recommendation-item" style="display: flex; align-items: center; gap: 15px; padding: 10px 0;">
          <div class="rec-avatar" style="width: 60px; height: 60px; flex-shrink: 0;">
            <img src="${userData.image}" alt="${userData.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div style="display: none; width: 100%; height: 100%; border-radius: 50%; background: linear-gradient(45deg, #FF9A9E, #FAD0C4); align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.8rem;">${userData.name.charAt(0)}</div>
          </div>
          <div class="rec-info">
            <div class="rec-name" style="font-size: 1.5rem; font-weight: 600; color: white;">${userData.name}</div>
            <div class="rec-percentage" style="font-size: 1rem; color: rgba(255, 255, 255, 0.8); margin-top: 5px;">${userData.xingzuo} Â· ${userData.mbti}</div>
          </div>
        </div>

        <div style="background: rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 25px; margin: 25px 0;">
          <h4 style="color: white; margin-top: 0; margin-bottom: 15px; font-size: 1.2rem; font-weight: 500;">ä¸ªäººä»‹ç»</h4>
          <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.7; font-size: 1rem; margin-bottom: 25px;">${userData.introduce}</p>
          
          <h4 style="color: white; margin-bottom: 15px; font-size: 1.1rem; font-weight: 500;">å…´è¶£çˆ±å¥½</h4>
          <div style="display: flex; flex-wrap: wrap; gap: 12px;">
            ${userData.hobby.split(',').map(hobby => 
              `<span style="background: rgba(110, 139, 255, 0.3); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem;">${hobby.trim()}</span>`
            ).join('')}
          </div>
        </div>

        <button style="width: 100%; padding: 18px; background: linear-gradient(45deg, #6E8BFF, #A06BFF); border: none; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; font-size: 1.1rem; letter-spacing: 1px;">
          ğŸ’Œ å‘èµ·çµé­‚å¯¹è¯
        </button>
      `;
    }

    // é—®å·å¼¹çª—äº‹ä»¶ç»‘å®š
    document.addEventListener('DOMContentLoaded', () => {
      // å…³é—­é—®å·å¼¹çª—äº‹ä»¶
      const closeQuestionnaireBtn = document.getElementById('closeQuestionnaireModal');
      if (closeQuestionnaireBtn) {
        closeQuestionnaireBtn.addEventListener('click', hideQuestionnaireModal);
      }

      // ç‚¹å‡»é—®å·å¼¹çª—å¤–éƒ¨å…³é—­
      const questionnaireModal = document.getElementById('questionnaireModal');
      if (questionnaireModal) {
        questionnaireModal.addEventListener('click', function(e) {
          if (e.target === this) {
            hideQuestionnaireModal();
          }
        });
      }
    });

    // ç”¨æˆ·å¡ç‰‡åˆ—è¡¨ç›¸å…³å˜é‡å’Œå‡½æ•°
    let currentPage = 1;
    let totalPages = 1;

    // åŠ è½½ç”¨æˆ·åˆ—è¡¨
    async function loadUserList(pageNum = 1) {
      console.log('=== å¼€å§‹åŠ è½½ç”¨æˆ·åˆ—è¡¨ï¼Œé¡µç :', pageNum, '===');
      
      const userCardsGrid = document.getElementById('userCardsGrid');
      const paginationContainer = document.getElementById('paginationContainer');
      
      if (!userCardsGrid) {
        console.error('æ‰¾ä¸åˆ°ç”¨æˆ·å¡ç‰‡ç½‘æ ¼å®¹å™¨');
        return;
      }
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€ - å…ˆåˆ›å»ºåŠ è½½å…ƒç´ ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å·²åˆ é™¤çš„å…ƒç´ 
      userCardsGrid.innerHTML = `
        <div class="cards-loading" id="cardsLoading" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
          <div class="loading-spinner"></div>
          <p style="color: white; margin-top: 20px;">æ­£åœ¨åŠ è½½ç”¨æˆ·ä¿¡æ¯...</p>
        </div>
      `;
      
      try {
        // è·å–token
        const token = localStorage.getItem('Authorization');
        
        const apiUrl = `http://127.0.0.1:9090/data/list?pageNum=${pageNum}`;
        console.log('è¯·æ±‚URL:', apiUrl);
        console.log('è¯·æ±‚Headers:', {
          'Authorization': token ? 'å·²è®¾ç½®ï¼ˆéšè—tokenï¼‰' : 'æœªè®¾ç½®',
          'Content-Type': 'application/json'
        });
        
        const response = await fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Authorization': token || '',
            'Content-Type': 'application/json'
          }
        });
        
        console.log('å“åº”çŠ¶æ€:', response.status, response.statusText);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('è·å–åˆ°çš„ç”¨æˆ·åˆ—è¡¨æ•°æ®:', data);
        console.log('æ•°æ®è®°å½•æ•°:', data.records ? data.records.length : 0);
        console.log('å½“å‰é¡µ:', data.current, 'æ€»é¡µæ•°:', data.pages);
        
        // æ›´æ–°é¡µç ä¿¡æ¯ - ç¡®ä¿ä½¿ç”¨æœåŠ¡å™¨è¿”å›çš„æ•°æ®
        if (data.current !== undefined) {
          currentPage = data.current;
        } else {
          currentPage = pageNum;
        }
        
        if (data.pages !== undefined && data.pages > 0) {
          totalPages = data.pages;
        }
        
        console.log('æ›´æ–°åçš„é¡µç  - å½“å‰é¡µ:', currentPage, 'æ€»é¡µæ•°:', totalPages);
        
        // æ¸²æŸ“ç”¨æˆ·å¡ç‰‡ï¼ˆä¼šè‡ªåŠ¨æ¸…é™¤åŠ è½½çŠ¶æ€ï¼‰
        renderUserCards(data.records || []);
        console.log('ç”¨æˆ·å¡ç‰‡æ¸²æŸ“å®Œæˆ');
        
        // æ›´æ–°ç¿»é¡µæŒ‰é’®çŠ¶æ€ - å¿…é¡»åœ¨æ›´æ–°é¡µç ä¿¡æ¯ä¹‹åè°ƒç”¨
        updatePaginationButtons();
        console.log('ç¿»é¡µæŒ‰é’®çŠ¶æ€å·²æ›´æ–°');
        
      } catch (error) {
        console.error('=== åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥ ===');
        console.error('é”™è¯¯ä¿¡æ¯:', error);
        console.error('è¯·æ±‚é¡µç :', pageNum);
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        userCardsGrid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: white;">
            <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>
            <p style="margin-bottom: 20px; font-size: 1.2rem;">åŠ è½½å¤±è´¥ï¼š${error.message}</p>
            <button class="pagination-btn" onclick="loadUserList(${pageNum})" style="margin: 0 auto;">
              é‡è¯•
            </button>
          </div>
        `;
      }
    }

    // æ¸²æŸ“ç”¨æˆ·å¡ç‰‡
    function renderUserCards(records) {
      console.log('å¼€å§‹æ¸²æŸ“ç”¨æˆ·å¡ç‰‡ï¼Œè®°å½•æ•°:', records ? records.length : 0);
      const userCardsGrid = document.getElementById('userCardsGrid');
      const paginationContainer = document.getElementById('paginationContainer');
      
      if (!records || records.length === 0) {
        console.log('æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€');
        userCardsGrid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: white;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ”</div>
            <p style="font-size: 1.2rem;">æš‚æ— ç”¨æˆ·æ•°æ®</p>
          </div>
        `;
        paginationContainer.style.display = 'none';
        return;
      }
      
      userCardsGrid.innerHTML = '';
      console.log('æ¸…ç©ºå¡ç‰‡å®¹å™¨ï¼Œå¼€å§‹æ¸²æŸ“', records.length, 'ä¸ªç”¨æˆ·å¡ç‰‡');
      
      let renderedCount = 0;
      records.forEach((record, index) => {
        console.log(`å¤„ç†ç¬¬ ${index + 1} æ¡è®°å½•:`, record);
        // æ¯ä¸ªrecordåŒ…å« xingzuo, mbti, hobby, informationæ•°ç»„
        const info = record.information && record.information.length > 0 ? record.information[0] : null;
        
        if (!info) {
          console.log(`ç¬¬ ${index + 1} æ¡è®°å½•æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è¿‡`);
          return; // å¦‚æœæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è¿‡
        }
        
        console.log(`æ¸²æŸ“ç”¨æˆ·: ${info.name}, å¹´é¾„: ${info.age}`);
        
        // è§£æhobbyå­—ç¬¦ä¸²ï¼ˆå¯èƒ½æ˜¯é€—å·åˆ†éš”çš„ï¼‰
        const hobbies = record.hobby ? record.hobby.split(',').map(h => h.trim()) : [];
        
        const card = document.createElement('div');
        card.className = 'user-card';
        
        // å¤´åƒéƒ¨åˆ†
        let avatarHTML = '';
        const hasImage = info.image && info.image.trim() !== '';
        if (hasImage) {
          avatarHTML = `<img src="${info.image}" alt="${info.name || 'ç”¨æˆ·'}" class="user-card-avatar" onerror="this.style.display='none'; this.parentElement.querySelector('.user-card-avatar-placeholder').style.display='flex';"><div class="user-card-avatar-placeholder" style="display: none;">${(info.name || 'ç”¨').charAt(0)}</div>`;
        } else {
          avatarHTML = `<div class="user-card-avatar-placeholder">${(info.name || 'ç”¨').charAt(0)}</div>`;
        }
        
        // è·å–ç”¨æˆ·id - ä¼˜å…ˆä½¿ç”¨record.idï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨info.id
        const userId = record.id || info.id || record.userId;
        
        card.innerHTML = `
          <div class="user-card-header">
            ${avatarHTML}
            <div class="user-card-info">
              <div class="user-card-name">${info.name || 'æœªçŸ¥ç”¨æˆ·'}</div>
              <div class="user-card-age">${info.age ? info.age + 'å²' : ''}</div>
              <div class="user-card-tags">
                ${record.xingzuo ? `<span class="user-card-tag">${record.xingzuo}</span>` : ''}
                ${record.mbti ? `<span class="user-card-tag">${record.mbti}</span>` : ''}
              </div>
            </div>
          </div>
          ${info.introduce ? `<div class="user-card-introduce">${info.introduce}</div>` : '<div class="user-card-introduce" style="opacity: 0.5;">æš‚æ— ä»‹ç»</div>'}
          ${hobbies.length > 0 ? `
            <div class="user-card-hobbies">
              <div class="user-card-hobbies-title">å…´è¶£çˆ±å¥½</div>
              <div class="user-card-tags">
                ${hobbies.slice(0, 4).map(hobby => `<span class="user-card-tag">${hobby}</span>`).join('')}
                ${hobbies.length > 4 ? `<span class="user-card-tag">+${hobbies.length - 4}</span>` : ''}
              </div>
            </div>
          ` : ''}
        `;
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œä¼ å…¥ç”¨æˆ·id
        if (userId) {
          card.addEventListener('click', () => {
            openChatModal(userId);
          });
        }
        
        userCardsGrid.appendChild(card);
        renderedCount++;
        console.log(`æˆåŠŸæ¸²æŸ“ç¬¬ ${renderedCount} ä¸ªç”¨æˆ·å¡ç‰‡`);
      });
      
      console.log(`æ€»å…±æ¸²æŸ“äº† ${renderedCount} ä¸ªç”¨æˆ·å¡ç‰‡`);
      
      // æ˜¾ç¤ºç¿»é¡µæŒ‰é’®
      paginationContainer.style.display = 'flex';
      console.log('ç¿»é¡µæŒ‰é’®å·²æ˜¾ç¤º');
    }

    // æ›´æ–°ç¿»é¡µæŒ‰é’®çŠ¶æ€
    function updatePaginationButtons() {
      const prevBtn = document.getElementById('prevPageBtn');
      const nextBtn = document.getElementById('nextPageBtn');
      const pageInfo = document.getElementById('pageInfo');
      
      console.log('æ›´æ–°ç¿»é¡µæŒ‰é’®çŠ¶æ€ - å½“å‰é¡µ:', currentPage, 'æ€»é¡µæ•°:', totalPages);
      
      if (prevBtn) {
        prevBtn.disabled = currentPage <= 1;
        console.log('ä¸Šä¸€é¡µæŒ‰é’®çŠ¶æ€:', prevBtn.disabled ? 'ç¦ç”¨' : 'å¯ç”¨');
      }
      
      if (nextBtn) {
        nextBtn.disabled = currentPage >= totalPages;
        console.log('ä¸‹ä¸€é¡µæŒ‰é’®çŠ¶æ€:', nextBtn.disabled ? 'ç¦ç”¨' : 'å¯ç”¨');
      }
      
      if (pageInfo) {
        const newText = `ç¬¬ ${currentPage} é¡µ / å…± ${totalPages} é¡µ`;
        pageInfo.textContent = newText;
        console.log('é¡µç ä¿¡æ¯å·²æ›´æ–°ä¸º:', newText);
      }
    }

    // ç¿»é¡µå‡½æ•°
    function changePage(direction) {
      console.log('ç¿»é¡µæŒ‰é’®è¢«ç‚¹å‡»ï¼Œæ–¹å‘:', direction);
      console.log('å½“å‰é¡µ:', currentPage, 'æ€»é¡µæ•°:', totalPages);
      
      const newPage = currentPage + direction;
      console.log('è®¡ç®—å‡ºçš„æ–°é¡µç :', newPage);
      
      // æ£€æŸ¥æ˜¯å¦è¶…å‡ºèŒƒå›´
      if (newPage < 1) {
        console.log('å·²ç»æ˜¯ç¬¬ä¸€é¡µï¼Œæ— æ³•å‘å‰ç¿»é¡µ');
        return;
      }
      
      // åªæœ‰å½“totalPages > 0 ä¸”å·²ç»åŠ è½½è¿‡æ•°æ®æ—¶ï¼Œæ‰æ£€æŸ¥ä¸Šé™
      // è¿™æ ·å¯ä»¥é¿å…é¦–æ¬¡åŠ è½½æ—¶totalPagesè¿˜æ˜¯åˆå§‹å€¼1çš„é—®é¢˜
      if (totalPages > 0 && newPage > totalPages) {
        console.log('å·²ç»æ˜¯æœ€åä¸€é¡µï¼Œæ— æ³•å‘åç¿»é¡µ');
        return;
      }
      
      console.log('å¼€å§‹åŠ è½½ç¬¬', newPage, 'é¡µ');
      currentPage = newPage;
      
      // è°ƒç”¨åŠ è½½å‡½æ•°ï¼Œä¼ å…¥æ–°çš„é¡µç 
      loadUserList(newPage);
      
      // æ»šåŠ¨åˆ°é¡¶éƒ¨
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ç”¨æˆ·åˆ—è¡¨
    window.addEventListener('load', () => {
      // å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿é¡µé¢å…¶ä»–å†…å®¹å…ˆåŠ è½½
      setTimeout(() => {
        loadUserList(1);
      }, 500);
    });

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€ï¼Œæ–¹ä¾¿HTMLè°ƒç”¨
    window.changePage = changePage;
    window.loadUserList = loadUserList;

    // èŠå¤©ç›¸å…³å˜é‡
    let currentChatUserId = null;
    let currentChatUserData = null;

    // æ‰“å¼€èŠå¤©å¼¹çª—
    function openChatModal(userId) {
      console.log('æ‰“å¼€èŠå¤©å¼¹çª—ï¼Œç”¨æˆ·ID:', userId);
      currentChatUserId = userId;
      
      const chatModal = document.getElementById('chatModal');
      const chatMessages = document.getElementById('chatMessages');
      const chatHeaderName = document.getElementById('chatHeaderName');
      const chatHeaderAvatar = document.getElementById('chatHeaderAvatar');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      chatMessages.innerHTML = `
        <div style="text-align: center; padding: 40px; color: #666;">
        </div>
      `;
      
      // æ˜¾ç¤ºå¼¹çª—
      chatModal.classList.add('show');
      
      // è·å–ç”¨æˆ·æ•°æ®
      fetchUserDataById(userId);
    }

    // æ ¹æ®idè·å–ç”¨æˆ·æ•°æ®
    async function fetchUserDataById(userId) {
      try {
        console.log('è·å–ç”¨æˆ·æ•°æ®ï¼ŒID:', userId);
        const response = await fetch(`http://127.0.0.1:9090/data/${userId}`, {
          method: 'GET',
          headers: {
            'Authorization': localStorage.getItem('Authorization') || '',
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const data = await response.json();
        console.log('è·å–åˆ°çš„ç”¨æˆ·æ•°æ®:', data);
        
        currentChatUserData = data;
        
        // æ›´æ–°èŠå¤©å¤´éƒ¨ä¿¡æ¯
        updateChatHeader(data);
        
        // æ¸…ç©ºæ¶ˆæ¯åŒºåŸŸï¼Œæ˜¾ç¤ºåˆå§‹é—®å€™
        displayInitialMessage();
        
      } catch (error) {
        console.error('è·å–ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
        const chatMessages = document.getElementById('chatMessages');
        chatMessages.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #ff4757;">
            <div style="font-size: 3rem; margin-bottom: 20px;">âš ï¸</div>
            <p>åŠ è½½å¤±è´¥ï¼š${error.message}</p>
          </div>
        `;
      }
    }

    // æ›´æ–°èŠå¤©å¤´éƒ¨ä¿¡æ¯
    function updateChatHeader(userData) {
      const chatHeaderName = document.getElementById('chatHeaderName');
      const chatHeaderAvatar = document.getElementById('chatHeaderAvatar');
      
      // ä»userDataä¸­æå–ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯recordæ ¼å¼æˆ–informationæ ¼å¼
      let userInfo = null;
      if (userData.information && userData.information.length > 0) {
        userInfo = userData.information[0];
      } else if (userData.name) {
        userInfo = userData;
      }
      
      if (userInfo) {
        chatHeaderName.textContent = userInfo.name || 'Chatterbot';
        if (userInfo.image) {
          chatHeaderAvatar.src = userInfo.image;
          chatHeaderAvatar.style.display = 'block';
        } else {
          chatHeaderAvatar.style.display = 'none';
        }
      }
    }

    // æ˜¾ç¤ºåˆå§‹é—®å€™æ¶ˆæ¯
    function displayInitialMessage() {
      const chatMessages = document.getElementById('chatMessages');
      
      // ä»userDataä¸­æå–ä¿¡æ¯
      let userInfo = null;
      if (currentChatUserData && currentChatUserData.information && currentChatUserData.information.length > 0) {
        userInfo = currentChatUserData.information[0];
      } else if (currentChatUserData && currentChatUserData.name) {
        userInfo = currentChatUserData;
      }
      
      
    }

    // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
    function addMessage(text, isOwn = false, avatarUrl = null) {
      const chatMessages = document.getElementById('chatMessages');
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isOwn ? 'own' : ''}`;
      
      // å¤´åƒ
      let avatarHTML = '';
      if (avatarUrl) {
        avatarHTML = `<img src="${avatarUrl}" class="message-avatar" alt="å¤´åƒ" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"><div class="message-avatar" style="display: none; width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(45deg, #6E8BFF, #A06BFF); align-items: center; justify-content: center; color: white; font-weight: 600;">${text.charAt(0)}</div>`;
      } else {
        avatarHTML = `<div class="message-avatar" style="width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(45deg, #6E8BFF, #A06BFF); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem;">ğŸ¤–</div>`;
      }
      
      messageDiv.innerHTML = `
        ${avatarHTML}
        <div class="message-bubble">${text}</div>
      `;
      
      chatMessages.appendChild(messageDiv);
      
      // æ»šåŠ¨åˆ°åº•éƒ¨
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // å‘é€æ¶ˆæ¯
    function sendMessage() {
      const chatInput = document.getElementById('chatInput');
      const messageText = chatInput.value.trim();
      
      if (!messageText) {
        return;
      }
      
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      addMessage(messageText, true);
      
      // æ¸…ç©ºè¾“å…¥æ¡†
      chatInput.value = '';
      
      // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å‘é€åˆ°åç«¯çš„é€»è¾‘
      console.log('å‘é€æ¶ˆæ¯:', messageText);
    }

    // AIé—®å€™åŠŸèƒ½
    async function sendAIGreeting() {
      if (!currentChatUserData) {
        alert('ç”¨æˆ·æ•°æ®æœªåŠ è½½å®Œæˆï¼Œè¯·ç¨å€™å†è¯•');
        return;
      }
      
      // è·å–ç”¨æˆ·çš„mbtiã€hobbyã€xingzuo
      const mbti = currentChatUserData.mbti || '';
      const hobby = currentChatUserData.hobby || '';
      const xingzuo = currentChatUserData.xingzuo || '';
      
      if (!mbti || !hobby || !xingzuo) {
        alert('è¯¥ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ— æ³•å‘é€AIé—®å€™');
        return;
      }
      
      const aiGreetingBtn = document.getElementById('aiGreetingBtn');
      const originalText = aiGreetingBtn.textContent;
      aiGreetingBtn.textContent = 'æ­£åœ¨ç”Ÿæˆé—®å€™...';
      aiGreetingBtn.disabled = true;
      
      try {
        const url = `http://127.0.0.1:9090/data/answer?mbti=${encodeURIComponent(mbti)}&hobby=${encodeURIComponent(hobby)}&xingzuo=${encodeURIComponent(xingzuo)}`;
        console.log('AIé—®å€™è¯·æ±‚URL:', url);
        
        const response = await fetch(url, {
          method: 'GET',
          headers: {
            'Authorization': localStorage.getItem('Authorization') || '',
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        // å…ˆè·å–å“åº”æ–‡æœ¬
        const responseText = await response.text();
        console.log('AIé—®å€™å“åº”æ–‡æœ¬:', responseText);
        
        // å°è¯•è§£æä¸ºJSONï¼Œå¦‚æœå¤±è´¥åˆ™ç›´æ¥ä½¿ç”¨æ–‡æœ¬
        let greetingText = '';
        try {
          const data = JSON.parse(responseText);
          console.log('AIé—®å€™å“åº”(JSON):', data);
          
          // å¦‚æœè§£ææˆåŠŸï¼Œæå–é—®å€™æ–‡æœ¬
          if (typeof data === 'string') {
            greetingText = data;
          } else if (data.message) {
            greetingText = data.message;
          } else if (data.text) {
            greetingText = data.text;
          } else if (data.answer) {
            greetingText = data.answer;
          } else {
            greetingText = JSON.stringify(data);
          }
        } catch (e) {
          // å¦‚æœè§£æå¤±è´¥ï¼Œè¯´æ˜æ˜¯çº¯æ–‡æœ¬å“åº”ï¼Œç›´æ¥ä½¿ç”¨
          console.log('å“åº”ä¸æ˜¯JSONæ ¼å¼ï¼Œä½¿ç”¨çº¯æ–‡æœ¬');
          greetingText = responseText.trim();
        }
        
        // æ˜¾ç¤ºAIé—®å€™æ¶ˆæ¯ï¼ˆæ˜¾ç¤ºåœ¨å³è¾¹ï¼Œæ ¼å¼å’Œç”¨æˆ·æ¶ˆæ¯ä¸€æ ·ï¼‰
        // isOwn = true è¡¨ç¤ºæ˜¾ç¤ºåœ¨å³ä¾§ï¼ˆç”¨æˆ·ä¾§ï¼‰
        addMessage(greetingText, true, null);
        
      } catch (error) {
        console.error('AIé—®å€™å¤±è´¥:', error);
        alert('AIé—®å€™å¤±è´¥ï¼š' + error.message);
      } finally {
        aiGreetingBtn.textContent = originalText;
        aiGreetingBtn.disabled = false;
      }
    }

    // å…³é—­èŠå¤©å¼¹çª—
    function closeChatModal() {
      const chatModal = document.getElementById('chatModal');
      chatModal.classList.remove('show');
      currentChatUserId = null;
      currentChatUserData = null;
    }

    // ç»‘å®šäº‹ä»¶
    document.addEventListener('DOMContentLoaded', () => {
      // å‘é€æŒ‰é’®äº‹ä»¶
      const chatSendBtn = document.getElementById('chatSendBtn');
      if (chatSendBtn) {
        chatSendBtn.addEventListener('click', sendMessage);
      }

      // è¾“å…¥æ¡†å›è½¦å‘é€
      const chatInput = document.getElementById('chatInput');
      if (chatInput) {
        chatInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });
      }

      // AIé—®å€™æŒ‰é’®äº‹ä»¶
      const aiGreetingBtn = document.getElementById('aiGreetingBtn');
      if (aiGreetingBtn) {
        aiGreetingBtn.addEventListener('click', sendAIGreeting);
      }

      // å…³é—­æŒ‰é’®äº‹ä»¶
      const closeChatBtn = document.getElementById('closeChatModal');
      if (closeChatBtn) {
        closeChatBtn.addEventListener('click', closeChatModal);
      }

      // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
      const chatModal = document.getElementById('chatModal');
      if (chatModal) {
        chatModal.addEventListener('click', (e) => {
          if (e.target === chatModal) {
            closeChatModal();
          }
        });
      }
      
      // æ–‡ä»¶ä¸Šä¼ æŒ‰é’®äº‹ä»¶ç»‘å®š
      const uploadVoiceBtn = document.getElementById('uploadVoiceBtn');
      if (uploadVoiceBtn) {
        uploadVoiceBtn.addEventListener('click', showFileUploadModal);
      }

      // æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
      const closeFileUploadModalBtn = document.getElementById('closeFileUploadModal');
      if (closeFileUploadModalBtn) {
        closeFileUploadModalBtn.addEventListener('click', hideFileUploadModal);
      }

      // å–æ¶ˆæ–‡ä»¶ä¸Šä¼ æŒ‰é’®äº‹ä»¶
      const cancelFileUploadBtn = document.getElementById('cancelFileUpload');
      if (cancelFileUploadBtn) {
        cancelFileUploadBtn.addEventListener('click', hideFileUploadModal);
      }

      // æ–‡ä»¶ä¸Šä¼ æäº¤æŒ‰é’®äº‹ä»¶
      const submitVoiceFileBtn = document.getElementById('submitVoiceFile');
      if (submitVoiceFileBtn) {
        submitVoiceFileBtn.addEventListener('click', uploadVoiceFile);
      }

      // ç‚¹å‡»æ–‡ä»¶ä¸Šä¼ æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      const fileUploadModal = document.getElementById('fileUploadModal');
      if (fileUploadModal) {
        fileUploadModal.addEventListener('click', (e) => {
          if (e.target === fileUploadModal) {
            hideFileUploadModal();
          }
        });
      }
    });

    // å°†å‡½æ•°è®¾ä¸ºå…¨å±€
    window.openChatModal = openChatModal;
    window.closeChatModal = closeChatModal;
    window.sendMessage = sendMessage;
    window.sendAIGreeting = sendAIGreeting;
  </script>
</body>
</html>
